box: tkelman/mingw@0.1.0
build:
  steps:
    - script:
        name: cross-compile julia for win32
        code: "export XC_HOST=i686-w64-mingw32;
              echo 'LLVM_FLAGS = ac_cv_have_decl_strerror_s=no' > Make.user;
              mkdir -p usr/bin;
              mkdir -p $WERCKER_CACHE_DIR/$XC_HOST;
              ls -al $WERCKER_CACHE_DIR/$XC_HOST;
              if [ -e $WERCKER_CACHE_DIR/$XC_HOST/usr.tar.xz ]; then
                time(tar -xJf $WERCKER_CACHE_DIR/$XC_HOST/usr.tar.xz);
              fi;
              for i in llvm fftw gmp mpfr pcre dsfmt; do
                if [ -e $WERCKER_CACHE_DIR/$XC_HOST/$i.tar.xz ]; then
                  time(tar -xJf $WERCKER_CACHE_DIR/$XC_HOST/$i.tar.xz);
                fi;
                time(make -j8 -C deps install-$i);
                if [ $i = suitesparse ]; then
                  time(tar -cJf $WERCKER_CACHE_DIR/$XC_HOST/$i.tar.xz deps/SuiteSparse-*/ deps/SuiteSparse-*.tar.gz);
                else
                  time(tar -cJf $WERCKER_CACHE_DIR/$XC_HOST/$i.tar.xz deps/$i-*/ deps/$i-*.tar.*);
                fi;
              done;
              time(tar -cJf $WERCKER_CACHE_DIR/$XC_HOST/usr.tar.xz usr);"
#              make win-extras;
#              make -j8 dist"
# llvm fftw gmp mpfr pcre dsfmt openblas suitesparse arpack
