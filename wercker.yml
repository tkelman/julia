box: ruudk/ubuntu14.04@1.0.0
build:
  steps:
    - script:
        name: copy saved apt-get cache
        code: "ls -al $WERCKER_CACHE_DIR;
              if [ -e $WERCKER_CACHE_DIR/archives ]; then
                sudo cp -rf $WERCKER_CACHE_DIR/archives/*.deb /var/cache/apt/archives;
              fi"
    - install-packages:
        packages: --no-install-recommends make git curl patch p7zip-full wine gcc g++-mingw-w64 gfortran-mingw-w64
#    - script:
#        name: add wine ppa
#        code: sudo apt-add-repository ppa:ubuntu-wine/ppa -y
#    - install-packages
#        packages: --no-install-recommends wine1.7
    - script:
        name: cross-compile julia
        code: "echo 'XC_HOST = i686-w64-mingw32' >> Make.user;
              make win-extras;
              if [ -e $WERCKER_CACHE_DIR/usr ]; then
                cp -r $WERCKER_CACHE_DIR/usr .;
              fi;
              for i in pcre fftw; do
                make -j8 -C deps install-$i;
              done;
              cp -rf usr $WERCKER_CACHE_DIR
              sudo cp -rf /var/cache/apt/archives $WERCKER_CACHE_DIR"
# make -j8 dist;
